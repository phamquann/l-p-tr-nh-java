<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõí Gi·ªè H√†ng - HUTECH</title>
    <th:block th:replace="~{layout::link-css}"></th:block>
    <th:block th:replace="~{layout::custom-css}"></th:block>
</head>

<body>

<th:block th:replace="~{layout::header}"></th:block>

<div class="container">
    <!-- Alert Messages -->
    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>‚úÖ Th√†nh c√¥ng!</strong> <span th:text="${successMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    
    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>‚ùå L·ªói!</strong> <span th:text="${errorMessage}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Page Header -->
    <div class="page-header-section">
        <div class="header-content">
            <h1 class="page-title">üõí Gi·ªè H√†ng C·ªßa B·∫°n</h1>
            <p class="page-description">
                <span class="badge bg-primary" th:text="'T·ªïng: ' + ${totalItems} + ' s·∫£n ph·∫©m'"></span>
            </p>
        </div>
        <a href="/books" class="btn-add-new">
            ‚Üê Ti·∫øp T·ª•c Mua S·∫Øm
        </a>
    </div>

    <!-- Cart Content -->
    <div th:if="${cart.items.isEmpty()}" class="empty-state-cart">
        <div class="empty-cart-icon">üõí</div>
        <h2 class="empty-cart-title">Gi·ªè h√†ng tr·ªëng</h2>
        <p class="empty-cart-text">H√£y th√™m s√°ch y√™u th√≠ch v√†o gi·ªè h√†ng c·ªßa b·∫°n!</p>
        <a href="/books" class="btn-shopping">üìö Kh√°m Ph√° S√°ch Ngay</a>
    </div>

    <div th:if="${!cart.items.isEmpty()}" class="cart-content">
        <!-- Cart Items -->
        <div class="cart-items-container">
            <h3 class="section-title">üì¶ S·∫£n ph·∫©m trong gi·ªè</h3>
            <div class="cart-item" th:each="item : ${cart.items}">
                <div class="item-image">
                    <span class="book-icon-large">üìö</span>
                </div>
                <div class="item-details">
                    <h4 class="item-title" th:text="${item.title}">T√™n s√°ch</h4>
                    <p class="item-author">
                        <span class="author-label">T√°c gi·∫£:</span> 
                        <span th:text="${item.author}">T√°c gi·∫£</span>
                    </p>
                    <div class="item-price">
                        <span class="price-label">ƒê∆°n gi√°:</span>
                        <span class="price-amount" th:text="${#numbers.formatDecimal(item.price, 1, 2)} + ' ƒë'">0 ƒë</span>
                    </div>
                </div>
                <div class="item-quantity">
                    <label class="quantity-label">S·ªë l∆∞·ª£ng</label>
                    <form th:action="@{/cart/update/{id}(id=${item.bookId})}" method="post" class="quantity-form">
                        <div class="quantity-control">
                            <button type="button" class="qty-btn qty-minus" onclick="decreaseQty(this)">‚àí</button>
                            <input type="number" name="quantity" th:value="${item.quantity}" 
                                   min="1" max="99" class="qty-input" readonly>
                            <button type="button" class="qty-btn qty-plus" onclick="increaseQty(this)">+</button>
                        </div>
                        <button type="submit" class="btn-update-qty">C·∫≠p nh·∫≠t</button>
                    </form>
                </div>
                <div class="item-subtotal">
                    <div class="subtotal-label">Th√†nh ti·ªÅn</div>
                    <div class="subtotal-amount" th:text="${#numbers.formatDecimal(item.subTotal, 1, 2)} + ' ƒë'">0 ƒë</div>
                </div>
                <div class="item-remove">
                    <a th:href="@{/cart/remove/{id}(id=${item.bookId})}" 
                       class="btn-remove"
                       onclick="return confirm('üóëÔ∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')"
                       title="X√≥a s·∫£n ph·∫©m">
                        <span class="remove-icon">‚úï</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <h3 class="summary-title">üí∞ T·ªïng ƒê∆°n H√†ng</h3>
            <div class="summary-content">
                <div class="summary-row">
                    <span class="summary-label">T·∫°m t√≠nh (<span th:text="${totalItems}">0</span> s·∫£n ph·∫©m):</span>
                    <span class="summary-value" th:text="${#numbers.formatDecimal(totalPrice, 1, 2)} + ' ƒë'">0 ƒë</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Ph√≠ v·∫≠n chuy·ªÉn:</span>
                    <span class="summary-value text-success">Mi·ªÖn ph√≠</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-row summary-total">
                    <span class="summary-label-total">T·ªïng c·ªông:</span>
                    <span class="summary-value-total" th:text="${#numbers.formatDecimal(totalPrice, 1, 2)} + ' ƒë'">0 ƒë</span>
                </div>
                
                <a th:href="@{/cart/checkout}" class="btn-checkout" style="display: block; text-align: center; text-decoration: none;">
                    üí≥ Ti·∫øn H√†nh Thanh To√°n
                </a>
                
                <a href="/cart/clear" class="btn-clear-cart" 
                   onclick="return confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô gi·ªè h√†ng?')">
                    üóëÔ∏è X√≥a T·∫•t C·∫£
                </a>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{layout::footer}"></th:block>

<script>
function decreaseQty(btn) {
    const input = btn.parentElement.querySelector('.qty-input');
    const currentVal = parseInt(input.value);
    if (currentVal > 1) {
        input.value = currentVal - 1;
    }
}

function increaseQty(btn) {
    const input = btn.parentElement.querySelector('.qty-input');
    const currentVal = parseInt(input.value);
    if (currentVal < 99) {
        input.value = currentVal + 1;
    }
}
</script>

</body>
</html>
